<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Test of the D3 framework</title>
    <script
	src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"
	charset="utf-8"></script>
  </head>

  <body>
    <script type="text/javascript">

      var svg = d3.select("body").append("svg")
        .attr("width", 800)
        .attr("height",800);

      var boxWidth = 400;
      var boxHeight = 400;
      var boxCentreX = 200;
      var boxCentreY = 200;
      var particleSize = 5;

      var maxBoxX = Math.abs(boxWidth + boxCentreX - particleSize);
      var maxBoxY = Math.abs(boxHeight + boxCentreY - particleSize);
      var minBoxX = Math.abs(boxCentreX + particleSize);
      var minBoxY = Math.abs(boxCentreY + particleSize);


      var particleData = [
        {mx:-2,my:2,px:340, py:350},
        //{mx:-3,my:-7,px:340,py:350},
        //{mx:-3,my:5,px:80,py:200},
        ];

      var box = d3.select("svg")
        .append("rect")
        .attr("width", boxWidth)
        .attr("height", boxHeight)
        .attr("x", boxCentreX)
        .attr("y",boxCentreY)
        .attr("fill", "none")
        .attr("stroke","black");

      var translateX = function(d, x){
        return d.px + x;
      }

      var translateY = function(d, y){
        return d.py + y;
      }

      var recalculateMomentum = function (d, grad, elasticity){
        d.mx = -1*d.mx;
        d.my = -1*d.my;
      }

        var particle = d3.select("svg").selectAll("circle").data(particleData);

        particle.enter().append("circle")
          .attr("cy", function (d){ return translateX(d,minBoxX)})
          .attr("cx", function (d){ return translateY(d,minBoxY)})
          .attr("r",particleSize)
          .attr("fill", "red");

        d3.timer( function(el) {
          particle.data(function() {
            // update the positions of the particles
            particleData.forEach(
              function (d,i){

                d.px += d.mx;
                d.py += d.my;

                if ( d.py <= minBoxY || d.py >= maxBoxY){
                //  recalculateMomentum(d, 45, 1);
                d.my = -1*d.my;
                };
                if ( d.px <= minBoxX || d.px >= maxBoxX){
                //  recalculateMomentum(d, 45, 1);
                d.mx = -1*d.mx;
                };

              }
            );


            return particleData;
          });


        particle.attr("cx", function(d, i) { return  translateX(d,minBoxX); });
        particle.attr("cy", function(d, i) { return  translateY(d,minBoxY); });
        return false;
        });



    </script>
  </body>
</html>
