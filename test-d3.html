<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Test of the D3 framework</title>
    <script
	src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"
	charset="utf-8"></script>
  </head>

  <body>
    <script type="text/javascript">

    var worldHeight = 1000;
    var worldWidth = 1000;

      var svg = d3.select("body").append("svg")
        .attr("width", worldWidth)
        .attr("height",worldHeight);

      var boxWidth = 800;
      var boxHeight = 800;
      var boxCentreX = (worldWidth - boxWidth) / 2;
      var boxCentreY = (worldHeight - boxWidth) / 2;
      var particleSize = 5;

      // coordinates of box edges
      var rightBoxEdge = Math.abs(boxWidth + boxCentreX - particleSize);
      var lowerBoxEdge = Math.abs(boxHeight + boxCentreY - particleSize);
      var leftBoxEdge = Math.abs(boxCentreX + particleSize);
      var upperBoxEdge = Math.abs(boxCentreY + particleSize);

      var boxCoordX = function(x){
        return x + boxCentreX;
      }

      var boxCoordY = function(y){
        return y + boxCentreY;
      }

      var particleData = [
        {mx:-2,my:6,px:boxCoordX(7), py:boxCoordY(7)},
        {mx:-3,my:-7,px:boxCoordX(540),py:boxCoordY(650)},
        {mx:-3,my:5,px:boxCoordX(790),py:boxCoordY(700)},
        {mx:-6,my:7,px:boxCoordX(60),py:boxCoordY(140)},
        {mx:-3,my:-5,px:boxCoordX(120),py:boxCoordY(250)},
        {mx:-35,my:-50,px:boxCoordX(245),py:boxCoordY(400)},
        {mx:-70,my:-05,px:boxCoordX(123),py:boxCoordY(456)},
        ];

      var box = d3.select("svg")
        .append("rect")
        .attr("width", boxWidth)
        .attr("height", boxHeight)
        .attr("x", boxCentreX)
        .attr("y",boxCentreY)
        .attr("fill", "b")
        .attr("stroke","white");



      var translateX = function(d, x){
        return d.px + x;
      }

      var translateY = function(d, y){
        return d.py + y;
      }

      var particle = d3.select("svg").selectAll("circle").data(particleData);

      particle.enter().append("circle")
        .attr("cy", function (d){ return d.py})
        .attr("cx", function (d){ return d.px})
        .attr("r",particleSize)
        .attr("fill", "white");

      d3.timer( function(el) {
        particle.data(function() {
          // update the positions of the particles
          particleData.forEach(
            function (d,i){

              d.px += d.mx;
              d.py += d.my;

              if ( d.py <= upperBoxEdge || d.py >= lowerBoxEdge){
              //  recalculateMomentum(d, 45, 1);
              d.my = -1*d.my;
              };
              if ( d.px <= leftBoxEdge || d.px >= rightBoxEdge){
              d.mx = -1*d.mx;
              };

            }
          );


          return particleData;
        });


      particle.attr("cx", function(d, i) { return  d.px; });
      particle.attr("cy", function(d, i) { return  d.py; });
      return false;
      });



    </script>
  </body>
</html>
