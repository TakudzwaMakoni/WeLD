<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Test of the D3 framework</title>
    <script
	src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"
	charset="utf-8"></script>
  </head>

  <body>
    <script type="text/javascript">

    var worldHeight = 1000;
    var worldWidth = 1000;
    var globalTime = 0;

      var svg = d3.select("body").append("svg")
        .attr("width", worldWidth)
        .attr("height",worldHeight);

      var boxWidth = 400;
      var boxHeight = 400;
      var boxCentreX = (worldWidth - boxWidth) / 2;
      var boxCentreY = (worldHeight - boxWidth) / 2;
      var particleSize = 2;

      // coordinates of box edges
      var rightBoxEdge = Math.abs(boxWidth + boxCentreX - particleSize);
      var lowerBoxEdge = Math.abs(boxHeight + boxCentreY - particleSize);
      var leftBoxEdge = Math.abs(boxCentreX + particleSize);
      var upperBoxEdge = Math.abs(boxCentreY + particleSize);

      var boxCoordX = function(x){
        return x + boxCentreX;
      }

      var boxCoordY = function(y){
        return y + boxCentreY;
      }

      var updateVerletP = function(d, dt = 1){
        d.px += d.vx + (0.5*Math.pow(dt,2)*((d.vx-d.ux)/2))
        d.py += d.vy + (0.5*Math.pow(dt,2)*((d.vy-d.uy)/2))
      }

      var randomNumber = function(min, max) {
        return Math.random() * (max - min) + min;
    }

    var data = new Array;
    for (var i = 0; i < 100 ; i++){
      n = {
        ux:0,
        uy:0,
        vx: randomNumber(-7,7),
        vy: randomNumber(-7,7),
        px: randomNumber(leftBoxEdge, rightBoxEdge),
        py: randomNumber(upperBoxEdge, lowerBoxEdge)
      }
      data.push(n)
    }
      var particleData = data;
      var box = d3.select("svg")
        .append("rect")
        .attr("width", boxWidth)
        .attr("height", boxHeight)
        .attr("x", boxCentreX)
        .attr("y",boxCentreY)
        .attr("fill", "b")
        .attr("stroke","white");

      var particle = d3.select("svg").selectAll("circle").data(particleData);

      particle.enter().append("circle")
        .attr("cy", function (d){ return d.py})
        .attr("cx", function (d){ return d.px})
        .attr("r",particleSize)
        .attr("fill", "white");

      d3.timer( function(el) {
        particle.data(function() {

          particleData.forEach(
            function (d,i){
              updateVerletP(d,1);
              if ( d.py <= upperBoxEdge || d.py >= lowerBoxEdge){
              d.vy = -1*d.vy;
              };
              if ( d.px <= leftBoxEdge || d.px >= rightBoxEdge){
              d.vx = -1*d.vx;
              };
            }
          );
          return particleData;
        });


      particle.attr("cx", function(d, i) { return  d.px; });
      particle.attr("cy", function(d, i) { return  d.py; });
      particle.attr("fill", function(d,i ) {return "rgb(" +randomNumber(0,255)+ ","+ randomNumber(0,255)+ ","+randomNumber(0,255)})
      globalTime++;
      return false;
      });



    </script>
  </body>
</html>
